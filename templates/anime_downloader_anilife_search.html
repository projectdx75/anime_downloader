{% extends "base.html" %} {% block content %}
    <div id="preloader" class="content-cloak">
        <div class='demo'>
            <!--        <div class="loader-inner">-->
            <div class='circle'>
                <div class='inner'></div>
            </div>
            <div class='circle'>
                <div class='inner'></div>
            </div>
            <div class='circle'>
                <div class='inner'></div>
            </div>
            <div class='circle'>
                <div class='inner'></div>
            </div>
            <div class='circle'>
                <div class='inner'></div>
            </div>
            <!--        </div>-->
        </div>
    </div>
    <div id="yommi_wrapper">
        <div class="input-group mb-2">
            <input
                    id="input_search"
                    type="search"
                    class="form-control rounded"
                    placeholder="Search"
                    aria-label="Search"
                    aria-describedby="search-addon"
            />
            <button id="btn_search" type="button" class="btn btn-primary">
                search
            </button>
        </div>

        <div>
            <div
                    id="anime_category"
                    class="btn-group"
                    role="group"
                    aria-label="Basic example"
            >
                <button id="ing" type="button" class="btn btn-success">방영중</button>
                <button id="theater" type="button" class="btn btn-primary">극장판</button>
                <button id="complete_anilist" type="button" class="btn btn-dark">
                    완결
                </button>
                <button id="top20" type="button" class="btn btn-grey">
                    Top20
                </button>
            </div>
            <form id="airing_list_form">
                <div id="airing_list"></div>
            </form>
            <form id="screen_movie_list_form">
                <div id="screen_movie_list" class="container"></div>
            </form>

            <form id="program_auto_form">
                <div id="episode_list"></div>
            </form>
        </div>
    </div>
    <!--전체-->
    <script src="{{ url_for('.static', filename='js/sjva_ui14.js') }}"></script>
    <script
            type="text/javascript"
            src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.lazyload/1.9.1/jquery.lazyload.min.js"
            integrity="sha512-jNDtFf7qgU0eH/+Z42FG4fw3w7DM/9zbgNPe3wfJlCylVDTT3IgKW5r92Vy9IHa6U50vyMz5gRByIu4YIXFtaQ=="
            crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script type="text/javascript">
        const package_name = "{{arg['package_name'] }}";
        const sub = "{{arg['sub'] }}";
        const anilife_url = "{{arg['anilife_url']}}";
        //let current_data = null;
        let page = 1;
        let next_page = Number
        let current_cate = ''
        let current_query = ''

        const observer = lozad('.lozad', {
            rootMargin: '10px 0px', // syntax similar to that of CSS Margin
            threshold: 0.1, // ratio of element convergence
            enableAutoReload: true // it will reload the new image when validating attributes changes
        });
        observer.observe();
        const loader = document.getElementById("preloader");

        const dismissLoadingScreen = async function () {
            // console.log("Before the delay")
            // await delay(2.5);
            loader.style.display = "none";
        };


        const get_anime_list = (type, page) => {
            // console.log(`type: ${type}, page: ${page}`)
            let url = ''
            let data = {"page": page, "type": type}

            switch (type) {
                case 'ing':
                    url = '/' + package_name + '/ajax/' + sub + '/anime_list'
                    current_cate = 'ing'
                    break;
                case 'movie':
                    url = '/' + package_name + '/ajax/' + sub + '/screen_movie_list'
                    current_cate = 'movie'
                    break;
                case 'theater':
                    url = '/' + package_name + '/ajax/' + sub + '/anime_list'
                    current_cate = 'theater'
                    break;
                case 'fin':
                    url = '/' + package_name + '/ajax/' + sub + '/complete_list'
                    current_cate = 'fin'
                    break
                case 'top20':
                    url = '/' + package_name + '/ajax/' + sub + '/anime_list'
                    current_cate = 'top20'
                    break
                default:
                    break;
            }

            $.ajax({
                    url: url,
                    type: "POST",
                    data: data,
                    cache: false,
                    dataType: "json",
                    success: (ret) => {
                        if (ret.ret === "error") {
                            $.notify("<strong>분석 실패</strong><br>" + ret.log, {
                                type: "warning",
                            });
                            // console.log("error")
                            dismissLoadingScreen()
                            return false;
                        }


                        current_screen_movie_data = ret
                        // console.log('ret::>', ret)

                        if (current_screen_movie_data !== '') {
                            if (type === "ing") {
                                make_airing_list(ret.data, page)
                                observer.observe();
                            } else if (type === "fin") {
                                make_screen_movie_list(ret.data, page)
                                observer.observe();
                            } else if (type === "theater") {
                                make_screen_movie_list(ret.data, page)
                                observer.observe();
                            } else {
                                make_screen_movie_list(ret.data, page)
                            }
                            div_visible = true
                            // console.log(div_visible)
                        }
                        dismissLoadingScreen()
                        next_page = page + 1
                    }
                }
            )
        }

        function make_airing_list(data, page) {
            let str = ''
            let tmp = ''

            str += '<div>';
            str += '<button type="button" class="btn btn-info">Page <span class="badge bg-warning">' + page + '</span></button>';
            str += '</div>';
            str += '<div id="inner_screen_movie" class="row infinite-scroll">';
            for (let i in data.anime_list) {

                tmp = '<div class=\"col-6 col-sm-4 col-md-3\">';
                tmp += '<div class=\"card\">';
                // 이미지 프록시를 통해 CDN 이미지 로드 (hotlink 보호 우회)
                let airingImgUrl = data.anime_list[i].image_link;
                if (airingImgUrl && airingImgUrl.includes('cdn.anilife.live')) {
                    airingImgUrl = '/' + package_name + '/ajax/' + sub + '/proxy_image?url=' + encodeURIComponent(airingImgUrl);
                }
                tmp += '<div class=\"card-img-container\">';
                tmp += '<img class=\"lazyload\" src=\"../static/img_loader_x200.svg\" data-original=\"' + airingImgUrl + '\" style=\"cursor: pointer\" onerror=\"this.src=\'../static/img_loader_x200.svg\'\" onclick=\"location.href=\'./request?code=' + data.anime_list[i].code + '\'\"/>';
                tmp += '<span class=\"episode-badge\">' + data.anime_list[i].epx + '</span>';
                tmp += '</div>';
                tmp += '<div class=\"card-body\">'
                tmp += '<h5 class=\"card-title\">' + data.anime_list[i].title + '</h5>';
                tmp += '<a href=\"./request?code=' + data.anime_list[i].code + '\" class=\"btn btn-primary cut-text\">' + data.anime_list[i].title + '</a>';
                tmp += '</div>';
                tmp += '</div>';
                tmp += '</div>';
                str += tmp

            }
            str += '</div>';
            str += m_hr_black();

            if (page > 1) {

                const temp = document.createElement('div')
                temp.innerHTML = str;
                while (temp.firstChild) {
                    document.getElementById("screen_movie_list").appendChild(temp.firstChild);
                }
                page++

            } else {

                document.getElementById("screen_movie_list").innerHTML = str;

            }

            $("img.lazyload").lazyload({
                threshold: 10,
                effect: "fadeIn",
            });

        }

        function make_search_result_list(data, page) {
            let str = ''
            let tmp = ''

            // console.log(data.anime_list, page)

            str += '<div>';
            str += '<button type="button" class="btn btn-info">Page <span class="badge bg-warning">' + page + '</span></button>';
            str += '</div>';
            str += '<div id="inner_screen_movie" class="row infinite-scroll">';
            for (let i in data.anime_list) {
                if (data.anime_list[i].wr_id !== '') {
                    const re = /bo_table=([^&]+)/
                    const bo_table = data.anime_list[i].link.match(re)
                    // // console.log(bo_table)
                    request_url = './request?code=' + data.anime_list[i].code + '&amp;wr_id=' + data.anime_list[i].wr_id + '&amp;bo_table=' + bo_table[1]
                } else {
                    request_url = './request?code=' + data.anime_list[i].code
                }

                tmp = '<div class="col-sm-4">';
                tmp += '<div class="card">';
                // 이미지 프록시를 통해 CDN 이미지 로드 (hotlink 보호 우회)
                let imgUrl = data.anime_list[i].image_link;
                if (imgUrl && imgUrl.includes('cdn.anilife.live')) {
                    imgUrl = '/' + package_name + '/ajax/' + sub + '/proxy_image?url=' + encodeURIComponent(imgUrl);
                }
                tmp += '<div class="card-img-container">';
                tmp += '<img class="card-img-top" src="' + imgUrl + '" onerror="this.src=\'../static/img_loader_x200.svg\'" />';
                tmp += '<span class="episode-badge">' + data.anime_list[i].epx + '</span>';
                tmp += '</div>';
                tmp += '<div class="card-body">'
                tmp += '<h5 class="card-title">' + data.anime_list[i].title + '</h5>';
                tmp += '<a href="' + request_url + '" class="btn btn-primary cut-text">' + data.anime_list[i].title + '</a>';
                tmp += '</div>';
                tmp += '</div>';
                tmp += '</div>';
                str += tmp

            }
            str += '</div>';
            str += m_hr_black();

            if (page > 1) {

                const temp = document.createElement('div')
                temp.innerHTML = str;
                while (temp.firstChild) {
                    document.getElementById("screen_movie_list").appendChild(temp.firstChild);
                }
                page++

            } else {
                document.getElementById("screen_movie_list").innerHTML = str;
            }

        }

        function make_screen_movie_list(data, page) {
            let str = ''
            let tmp = ''

            // console.log(data.anime_list, page)

            str += '<div>';
            str += '<button type="button" class="btn btn-info">Page <span class="badge bg-warning">' + page + '</span></button>';
            str += '</div>';
            str += '<div id="inner_screen_movie" class="row infinite-scroll">';
            for (let i in data.anime_list) {

                tmp = '<div class="col-sm-4">';
                tmp += '<div class="card">';
                // 이미지 프록시를 통해 CDN 이미지 로드 (hotlink 보호 우회)
                let screenImgUrl = data.anime_list[i].image_link;
                if (screenImgUrl && screenImgUrl.includes('cdn.anilife.live')) {
                    screenImgUrl = '/' + package_name + '/ajax/' + sub + '/proxy_image?url=' + encodeURIComponent(screenImgUrl);
                }
                tmp += '<div class="card-img-container">';
                tmp += '<img class="card-img-top" src="' + screenImgUrl + '" onerror="this.src=\'../static/img_loader_x200.svg\'" />';
                if (data.anime_list[i].epx) {
                    tmp += '<span class="episode-badge">' + data.anime_list[i].epx + '</span>';
                }
                tmp += '</div>';
                tmp += '<div class="card-body">'
                tmp += '<h5 class="card-title">' + data.anime_list[i].title + '</h5>';
                tmp += '<a href="./request?code=' + data.anime_list[i].code + '" class="btn btn-primary cut-text">' + data.anime_list[i].title + '</a>';
                tmp += '</div>';
                tmp += '</div>';
                tmp += '</div>';
                str += tmp

            }
            str += '</div>';
            str += m_hr_black();

            if (page > 1) {

                const temp = document.createElement('div')
                temp.innerHTML = str;
                while (temp.firstChild) {
                    document.getElementById("screen_movie_list").appendChild(temp.firstChild);
                }
                page++

            } else {
                document.getElementById("screen_movie_list").innerHTML = str;
            }

            $("img.lazyload").lazyload({
                threshold: 10,
                effect: "fadeIn",
            });

        }


        $(document).ready(function () {

            // if ( "{{arg['anilife_current_code']}}" !== "" ) {
            //     document.getElementById("code").value = "{{arg['anilife_current_code']}}";
            //     // 값이 공백이 아니면 분석 버튼 계속 누름
            //     document.getElementById("analysis_btn").click();
            // }
            $("#input_search").keydown(function (key) {
                if (key.keyCode === 13) {
                    // alert("엔터키를 눌렀습니다.");
                    $("#btn_search").trigger("click");
                }
            })

            get_anime_list("ing", 1)


            const observer = lozad('.lozad', {
                rootMargin: '10px 0px', // syntax similar to that of CSS Margin
                threshold: 0.1, // ratio of element convergence
                enableAutoReload: true // it will reload the new image when validating attributes changes
            });
            observer.observe();

        });

        $("body").on("click", "#btn_search", function (e) {
            e.preventDefault();
            let query = $("#input_search").val();
            // console.log(query);
            current_cate = "search"
            current_query = query

            if ($("#input_search").val() === "") {
                // console.log("search keyword nothing");
                return false;
            }

            $.ajax({
                url: "/" + package_name + "/ajax/" + sub + "/search",
                type: "POST",
                cache: false,
                data: {query: query, type: current_cate, page: page},
                // dataType: "json",
                contentType: "application/x-www-form-urlencoded; charset=UTF-8",
                success: function (ret) {
                    if (ret.ret) {
                        // console.log('ret:::', ret)
                        make_search_result_list(ret.data, 1);
                        next_page = page + 1
                    } else {
                        $.notify("<strong>분석 실패</strong><br>" + ret.log, {
                            type: "warning",
                        });
                        dismissLoadingScreen()
                    }
                },
            });
        });

        $('#anime_category #ing').on("click", function () {
            // {#// console.log(this.id)#}
            let spinner = document.getElementById('spinner');
            spinner.style.visibility = 'visible';
            get_anime_list("ing", 1)
        })

        $('#anime_category #complete_anilist').on("click", function () {
            // {#// console.log(this.id)#}
            let spinner = document.getElementById('spinner');
            spinner.style.visibility = 'visible';
            get_anime_list("fin", 1)
        })

        $('#anime_category #theater').on("click", function () {
            // {#// console.log(this.id)#}
            let spinner = document.getElementById('spinner');
            spinner.style.visibility = 'visible';
            get_anime_list("theater", 1)
        })

        $('#anime_category #top20').on("click", function () {
            // {#// console.log(this.id)#}
            let spinner = document.getElementById('spinner');
            spinner.style.visibility = 'visible';
            get_anime_list("top20", 1)
        })

        // 분석 버튼 클릭시 호출
        $("body").on('click', '#analysis_btn', function (e) {
            e.preventDefault();
            const code = document.getElementById("code").value
            // console.log(code)
            $.ajax({
                url: '/' + package_name + '/ajax/' + sub + '/analysis',
                type: "POST",
                cache: false,
                data: {code: code},
                dataType: "json",
                success: function (ret) {
                    if (ret.ret === 'success' && ret.data != null) {
                        // // console.log(ret.code)
                        // console.log(ret.data)
                        make_program(ret.data)
                    } else {
                        $.notify('<strong>분석 실패</strong><br>' + ret.log, {type: 'warning'});
                        dismissLoadingScreen()
                    }
                }
            });
        });


        $("body").on('click', '#go_anilife_btn', function (e) {
            e.preventDefault();
            window.open("{{arg['anilife_url']}}", "_blank");
        });

        $("body").on('click', '#all_check_on_btn', function (e) {
            e.preventDefault();
            $('input[id^="checkbox_"]').bootstrapToggle('on')
        });

        $("body").on('click', '#all_check_off_btn', function (e) {
            e.preventDefault();
            $('input[id^="checkbox_"]').bootstrapToggle('off')
        });

        $("body").on('click', '#add_queue_btn', function (e) {
            e.preventDefault();
            data = current_data.episode[$(this).data('idx')];
            // console.log('data:::>', data)
            $.ajax({
                url: '/' + package_name + '/ajax/' + sub + '/add_queue',
                type: "POST",
                cache: false,
                data: {data: JSON.stringify(data)},
                dataType: "json",
                success: function (data) {
                    if (data.ret == 'enqueue_db_append' || data.ret == 'enqueue_db_exist') {
                        $.notify('<strong>다운로드 작업을 추가 하였습니다.</strong>', {type: 'success'});
                    } else if (data.ret == 'queue_exist') {
                        $.notify('<strong>이미 큐에 있습니다. 삭제 후 추가하세요.</strong>', {type: 'warning'});
                    } else if (data.ret == 'db_completed') {
                        $.notify('<strong>DB에 완료 기록이 있습니다.</strong>', {type: 'warning'});
                    } else {
                        $.notify('<strong>추가 실패</strong><br>' + ret.log, {type: 'warning'});
                    }
                }
            });
        });
        // const observer = lozad();
        //  	const el = document.querySelector('img');
        // const observer = lozad(el); // passing a `NodeList` (e.g. `document.querySelectorAll()`) is also valid
        // observer.observe();
        const loadNextAnimes = (cate, page) => {
            spinner.style.display = "block";
            let data = {type: cate, page: String(page)};
            let url = ''
            switch (cate) {
                case 'ing':
                    url = '/' + package_name + '/ajax/' + sub + '/anime_list'
                    current_cate = 'ing'
                    break;
                case 'movie':
                    url = '/' + package_name + '/ajax/' + sub + '/screen_movie_list'
                    current_cate = 'movie'
                    break;
                case 'theater':
                    url = '/' + package_name + '/ajax/' + sub + '/anime_list'
                    current_cate = 'theater'
                    break;
                case 'fin':
                    url = '/' + package_name + '/ajax/' + sub + '/complete_list'
                    current_cate = 'fin'
                    break
                case 'search':
                    url = "/" + package_name + "/ajax/" + sub + "/search"
                    current_cate = 'search'
                    data.query = current_query
                    break;
                default:
                    break;
            }

            fetch(url, {
                method: "POST",
                cache: "no-cache",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                },
                body: new URLSearchParams(data),
            })
                .then((res) => res.json())
                .then((response) => {
                    // // console.log("Success:", JSON.stringify(response));
                    // {#imagesContainer.appendChild()#}
                    // console.log("return page:::> ", String(response.page));
                    // {#page = response.page#}
                    if (current_cate === 'search') {
                        make_search_result_list(response.data, response.page);

                    } else {
                        make_screen_movie_list(response.data, response.page);
                    }
                    page++;
                    next_page++;
                })
                .catch((error) => console.error("Error:", error));
        };


        const onScroll = (e) => {
            console.dir(e.target.scrollingElement.scrollHeight);
            const {scrollTop, scrollHeight, clientHeight} = e.target.scrollingElement;
            if (Math.round(scrollHeight - scrollTop) <= clientHeight) {
                document.getElementById("spinner").style.display = "block";
                // console.log("loading");
                // console.log("now page::> ", page);
                // console.log("next_page::> ", String(next_page));
                loadNextAnimes(current_cate, next_page);
            }
        };

        const debounce = (func, delay) => {
            let timeoutId = null;
            return (...args) => {
                clearTimeout(timeoutId);
                timeoutId = setTimeout(func.bind(null, ...args), delay);
            };
        };

        document.addEventListener("scroll", debounce(onScroll, 300));
    </script>
    <style>
        button.code-button {
            min-width: 82px !important;
        }

        .tooltip {
            position: relative;
            display: block;
        }

        @media (min-width: 576px) {
            .container {
                max-width: 100%;
            }

            .card-columns {
                column-count: 2;
                column-gap: 1.25rem;
            }

            .card-columns .card {
                display: inline-block;
            }
        }


        @media (min-width: 768px) {
            .card-columns {
                column-count: 3;
            }
        }

        /* Large devices (desktops, 992px and up) */
        @media (min-width: 992px) {
            .card-columns {
                column-count: 3;
            }
        }

        /* Extra large devices (large desktops, 1200px and up) */
        @media (min-width: 1200px) {
            .card-columns {
                column-count: 5;
            }

            #yommi_wrapper {
                max-width: 80%;
                margin: 0 auto;
            }
        }


        [data-tooltip-text]:hover {
            position: relative;
        }

        [data-tooltip-text]:after {
            -webkit-transition: bottom 0.3s ease-in-out, opacity 0.3s ease-in-out;
            -moz-transition: bottom 0.3s ease-in-out, opacity 0.3s ease-in-out;
            transition: bottom 0.3s ease-in-out, opacity 0.3s ease-in-out;

            background-color: rgba(0, 0, 0, 0.8);

            -webkit-box-shadow: 0px 0px 3px 1px rgba(50, 50, 50, 0.4);
            -moz-box-shadow: 0px 0px 3px 1px rgba(50, 50, 50, 0.4);
            box-shadow: 0px 0px 3px 1px rgba(50, 50, 50, 0.4);

            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;

            color: #ffffff;
            font-size: 12px;
            margin-bottom: 10px;
            padding: 7px 12px;
            position: absolute;
            width: auto;
            min-width: 50px;
            max-width: 300px;
            word-wrap: break-word;

            z-index: 9999;

            opacity: 0;
            left: -9999px;
            top: 90%;

            content: attr(data-tooltip-text);
        }

        [data-tooltip-text]:hover:after {
            top: 230%;
            left: 0;
            opacity: 1;
        }

        [data-tooltip-text]:hover {
            position: relative;
        }

        [data-tooltip-text]:after {
            -webkit-transition: bottom 0.3s ease-in-out, opacity 0.3s ease-in-out;
            -moz-transition: bottom 0.3s ease-in-out, opacity 0.3s ease-in-out;
            transition: bottom 0.3s ease-in-out, opacity 0.3s ease-in-out;

            background-color: rgba(0, 0, 0, 0.8);

            -webkit-box-shadow: 0px 0px 3px 1px rgba(50, 50, 50, 0.4);
            -moz-box-shadow: 0px 0px 3px 1px rgba(50, 50, 50, 0.4);
            box-shadow: 0px 0px 3px 1px rgba(50, 50, 50, 0.4);

            -webkit-border-radius: 5px;
            -moz-border-radius: 5px;
            border-radius: 5px;

            color: #ffffff;
            font-size: 12px;
            margin-bottom: 10px;
            padding: 7px 12px;
            position: absolute;
            width: auto;
            min-width: 50px;
            max-width: 300px;
            word-wrap: break-word;

            z-index: 9999;

            opacity: 0;
            left: -9999px;
            top: -210% !important;

            content: attr(data-tooltip-text);
        }

        [data-tooltip-text]:hover:after {
            top: 130%;
            left: 0;
            opacity: 1;
        }

        #airing_list {
            display: none;
        }

        .cut-text {
            text-overflow: ellipsis;
            overflow: hidden;
            white-space: nowrap;
            width: 100%;
        }

        .btn {
            white-space: normal !important;
            word-wrap: break-word;
        }

        #screen_movie_list {
            margin-top: 10px;
        }

        /* 카드 레이아웃 개선 */
        .card {
            height: 100%;
            display: flex;
            flex-direction: column;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            margin-bottom: 20px;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        /* 이미지 고정 비율 (3:4 포스터 비율) */
        .card img,
        .card .card-img-top,
        .card .lazyload {
            width: 100%;
            aspect-ratio: 3 / 4;
            object-fit: cover;
            border-radius: 12px 12px 0 0;
        }

        /* Card Image Container for Badge Overlay */
        .card-img-container {
            position: relative;
            overflow: hidden;
        }
        
        /* Episode Badge Overlay */
        .episode-badge {
            position: absolute;
            bottom: 8px;
            right: 8px;
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            color: white;
            font-size: 11px;
            font-weight: 700;
            padding: 4px 10px;
            border-radius: 6px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.4);
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .card-body {
            padding: 12px !important;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            background: rgba(0, 0, 0, 0.6);
        }

        .card-title {
            padding: 0 !important;
            margin-bottom: 8px;
            font-size: 0.95rem;
            font-weight: 600;
            color: #fff;
            line-height: 1.3;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .card-text {
            font-size: 0.8rem;
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 4px;
        }

        .card .btn-primary {
            margin-top: auto;
            border-radius: 8px;
            font-size: 0.85rem;
            padding: 8px 12px;
        }

    
    /* Navigation Menu Override */
    ul.nav.nav-pills.bg-light {
        background-color: rgba(30, 41, 59, 0.6) !important;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 50rem !important;
        padding: 6px !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2) !important;
        display: inline-flex !important;
        flex-wrap: wrap;
        justify-content: center;
        width: auto !important;
        margin-bottom: 20px;
    }

    ul.nav.nav-pills .nav-item {
        margin: 0 2px;
    }

    ul.nav.nav-pills .nav-link {
        border-radius: 50rem !important;
        padding: 8px 20px !important;
        color: #94a3b8 !important;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    ul.nav.nav-pills .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: #fff !important;
        transform: translateY(-1px);
    }

    ul.nav.nav-pills .nav-link.active {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
        color: #fff !important;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
    }
    
        /* 그리드 간격 조정 */
        .row.infinite-scroll {
            gap: 0;
        }

        .row.infinite-scroll > [class*="col-"] {
            padding: 10px;
        }

        button#add_whitelist {
            float: right;
        }

        button.btn-favorite {
            background-color: #e0ff42;
        }

        body {
            font-family: 'Inter', 'Noto Sans KR', NanumSquareNeo, system-ui, -apple-system, Segoe UI, Roboto, Helvetica Neue, sans-serif;
        }

        /* ========== Cosmic Violet Theme (Anilife Exclusive) ========== */
        body {
            background: linear-gradient(135deg, #1e1b4b 0%, #312e81 40%, #4c1d95 100%) !important;
            background-attachment: fixed;
            color: #e0e7ff;
            min-height: 100vh;
        }

        /* Search Bar Styling */
        #yommi_wrapper {
            padding: 20px 15px;
        }
        
        .input-group {
            background: rgba(49, 46, 129, 0.5);
            border-radius: 12px;
            padding: 6px;
            border: 1px solid rgba(167, 139, 250, 0.25);
            backdrop-filter: blur(10px);
        }
        
        .input-group #input_search {
            background: rgba(30, 27, 75, 0.7) !important;
            border: 1px solid rgba(167, 139, 250, 0.2) !important;
            color: #e0e7ff !important;
            border-radius: 8px !important;
            padding: 12px 16px !important;
            font-size: 15px;
        }
        
        .input-group #input_search::placeholder {
            color: #c4b5fd;
            opacity: 0.7;
        }
        
        .input-group #input_search:focus {
            outline: none !important;
            border-color: #a78bfa !important;
            box-shadow: 0 0 0 2px rgba(167, 139, 250, 0.3) !important;
        }
        
        .input-group #btn_search {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%) !important;
            border: none !important;
            border-radius: 8px !important;
            padding: 10px 24px !important;
            font-weight: 600;
            color: white;
            transition: all 0.3s ease;
        }
        
        .input-group #btn_search:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        /* Category Buttons */
        #anime_category {
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        #anime_category .btn {
            background: rgba(49, 46, 129, 0.5) !important;
            border: 1px solid rgba(167, 139, 250, 0.3) !important;
            color: #c4b5fd !important;
            border-radius: 20px !important;
            padding: 8px 20px !important;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        #anime_category .btn:hover {
            background: rgba(139, 92, 246, 0.3) !important;
            border-color: #a78bfa !important;
            color: #fff !important;
            transform: translateY(-2px);
        }
        
        #anime_category .btn-success {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%) !important;
            border-color: transparent !important;
            color: white !important;
        }
        
        #anime_category .btn-primary {
            background: linear-gradient(135deg, #6366f1 0%, #4f46e5 100%) !important;
            border-color: transparent !important;
            color: white !important;
        }
        
        #anime_category .btn-dark {
            background: linear-gradient(135deg, #475569 0%, #334155 100%) !important;
            border-color: transparent !important;
        }
        
        #anime_category .btn-grey {
            background: linear-gradient(135deg, #f472b6 0%, #ec4899 100%) !important;
            border-color: transparent !important;
            color: white !important;
        }

        /* Page Badge */
        .btn-info {
            background: linear-gradient(135deg, #a78bfa 0%, #8b5cf6 100%) !important;
            border: none !important;
            border-radius: 8px !important;
            margin-bottom: 15px;
        }
        
        .badge.bg-warning {
            background: #fbbf24 !important;
            color: #1e293b !important;
        }

        /* Card Styling Override */
        .card {
            background: rgba(49, 46, 129, 0.5) !important;
            border: 1px solid rgba(167, 139, 250, 0.15) !important;
            backdrop-filter: blur(8px);
        }
        
        .card:hover {
            border-color: rgba(167, 139, 250, 0.4) !important;
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.2) !important;
        }
        
        .card-body {
            background: linear-gradient(180deg, rgba(30, 27, 75, 0.85) 0%, rgba(30, 27, 75, 0.95) 100%) !important;
        }
        
        .card-title {
            color: #a78bfa !important;
        }
        
        .card-text {
            color: #c4b5fd !important;
        }
        
        .card .btn-primary {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%) !important;
            border: none !important;
        }
        
        .card .btn-primary:hover {
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }

        /* Spinner */
        #spinner {
            color: #a78bfa;
        }

        .demo {
            width: 100px;
            height: 102px;
            border-radius: 100%;
            position: absolute;
            top: 45%;
            left: calc(50% - 50px);
        }

        .circle {
            width: 100%;
            height: 100%;
            position: absolute;
        }

        .circle .inner {
            width: 100%;
            height: 100%;
            border-radius: 100%;
            border: 5px solid rgba(0, 255, 170, 0.7);
            border-right: none;
            border-top: none;
            background-clip: padding;
            box-shadow: inset 0px 0px 10px rgba(0, 255, 170, 0.15);
        }

        @-webkit-keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }
            to {
                transform: rotate(360deg);
            }
        }

        .circle:nth-of-type(0) {
            transform: rotate(0deg);
        }

        .circle:nth-of-type(0) .inner {
            -webkit-animation: spin 2s infinite linear;
            animation: spin 2s infinite linear;
        }

        .circle:nth-of-type(1) {
            transform: rotate(70deg);
        }

        .circle:nth-of-type(1) .inner {
            -webkit-animation: spin 2s infinite linear;
            animation: spin 2s infinite linear;
        }

        .circle:nth-of-type(2) {
            transform: rotate(140deg);
        }

        .circle:nth-of-type(2) .inner {
            -webkit-animation: spin 2s infinite linear;
            animation: spin 2s infinite linear;
        }

        .demo {
            -webkit-animation: spin 5s infinite linear;
            animation: spin 5s infinite linear;
            background: rgba(0, 0, 0, 0.2);
            background: radial-gradient(#222, #000);
            bottom: 0;
            left: 0;
            overflow: hidden;
            /*position: fixed;*/
            right: 0;
            /*top: 0;*/
            z-index: 99999;
            opacity: 0.5;
            margin: 0 auto;
            transform: translate(-50%, -50%);
            position: absolute;
            top: 50%;

        }

        .loader-inner {
            bottom: 0;
            height: 60px;
            left: 0;
            margin: auto;
            position: absolute;
            right: 0;
            top: 0;
            width: 100px;
        }

        #preloader {
            /*background-color: green;*/
            /*color: white;*/
            /*height: 100vh;*/
            /*width: 100%;*/
            /*position: fixed;*/
            /*z-index: 100;*/
            background: rgba(0, 0, 0, 0.2);
            background: radial-gradient(#222, #000);
            bottom: 0;
            left: 0;
            overflow: hidden;
            position: fixed;
            right: 0;
            top: 0;
            z-index: 99999;
            opacity: 0.5;
        }

    </style>

<style>
    /* Smooth Load Transition */
    .content-cloak, 
    #menu_module_div, 
    #menu_page_div {
        opacity: 0;
        transition: opacity 0.5s ease-out;
    }
    
    /* Staggered Delays for Natural Top-Down Flow */
    #menu_module_div.visible {
        opacity: 1;
        transition-delay: 0ms;
    }

    #menu_page_div.visible {
        opacity: 1;
        transition-delay: 150ms;
    }

    .content-cloak.visible {
        opacity: 1;
        transition-delay: 300ms;
    }
    
    /* Navigation Menu Override (Top Sub-menu) */
    ul.nav.nav-pills.bg-light {
        background-color: rgba(30, 41, 59, 0.6) !important;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 50rem !important;
        padding: 6px !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2) !important;
        display: inline-flex !important;
        flex-wrap: wrap;
        justify-content: center;
        width: auto !important;
        margin-bottom: 20px;
    }

    ul.nav.nav-pills .nav-item { margin: 0 2px; }
    ul.nav.nav-pills .nav-link {
        border-radius: 50rem !important;
        padding: 8px 20px !important;
        color: #94a3b8 !important;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    ul.nav.nav-pills .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: #fff !important;
        transform: translateY(-1px);
    }
    ul.nav.nav-pills .nav-link.active {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
        color: #fff !important;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
    }
</style>

<script type="text/javascript">
$(document).ready(function(){
  // Smooth Load Trigger
  setTimeout(function() {
      $('.content-cloak, #menu_module_div, #menu_page_div').addClass('visible');
  }, 100);
});
</script>
<style>
/* Mobile Margin Fix */
@media (max-width: 768px) {
    body { overflow-x: hidden !important; padding: 0 !important; margin: 0 !important; padding-top: 10px !important; }
    ul.nav.nav-pills.bg-light {
        margin-top: 50px !important;
        margin-bottom: 10px !important;
        width: 100% !important;
        display: flex !important;
        border-radius: 12px !important;
    }
    ul.nav.nav-pills .nav-link {
        padding: 6px 12px !important;
        font-size: 13px;
    }
    .container, .container-fluid, .row, form, #program_list, #program_auto_form, #episode_list, .queue-container, #yommi_wrapper, #main_container {
        width: 100% !important; max-width: 100% !important;
        padding-left: 4px !important; padding-right: 4px !important;
        margin-left: 0 !important; margin-right: 0 !important;
        box-sizing: border-box !important;
    }
    .form-group, .form-inline, [class*="col-"] {
        flex: 0 0 100% !important; max-width: 100% !important; width: 100% !important;
        padding-left: 0 !important; padding-right: 0 !important;
    }
    .row { margin-left: 0 !important; margin-right: 0 !important; }
    .card, .card.p-4, .card.p-lg-5, .card.border-light {
         width: calc(100% - 8px) !important; max-width: 100% !important;
         padding: 8px !important; margin: 4px !important;
         border-radius: 12px !important; box-sizing: border-box !important;
    }
    .badge {
        white-space: normal !important; text-align: left !important;
        line-height: 1.4 !important; height: auto !important; display: inline-block !important;
    }
    
    /* Search Button Size Reduction */
    .input-group #btn_search {
        padding: 8px 14px !important;
        font-size: 13px !important;
    }
}
</style>
{% endblock %}
