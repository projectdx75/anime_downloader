{% extends "base.html" %} {% block content %}
<link rel="stylesheet" href="{{ url_for('.static', filename='css/mobile_custom.css') }}"/>
<link rel="stylesheet" href="{{ url_for('.static', filename='css/' ~ arg['sub'] ~ '.css') }}"/>



<style>
/* Global Container Margin Overrides */
#main_container {
    width: 100% !important;
    max-width: 100% !important;
    padding-left: 15px !important;
    padding-right: 15px !important;
    margin-left: 0 !important;
    margin-right: 0 !important;
}
.container, .container-fluid {
    width: 100% !important;
    max-width: 100% !important;
    padding-left: 0 !important;
    padding-right: 0 !important;
}
</style>

<div id="yommi_wrapper" class="container-fluid mt-2 mt-md-4 mx-auto anilife-common-wrapper content-cloak">
    <div id="preloader" class="loader">
        <div class="loader-inner">
            <div class="loader-line-wrap"><div class="loader-line"></div></div>
            <div class="loader-line-wrap"><div class="loader-line"></div></div>
            <div class="loader-line-wrap"><div class="loader-line"></div></div>
            <div class="loader-line-wrap"><div class="loader-line"></div></div>
            <div class="loader-line-wrap"><div class="loader-line"></div></div>
        </div>
    </div>
    
    <form id="program_list">
        <div class="card p-2 p-md-4 mb-2 mb-md-4 border-0" style="background: rgba(49, 46, 129, 0.6); backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(139, 92, 246, 0.2); border-radius: 16px;">
            <div class="form-group mb-0">
                <label for="code" class="text-white font-weight-bold mb-2" style="color: #c4b5fd !important;">
                    <i class="fa fa-search mr-2" style="color: #a78bfa;"></i>작품 Code
                </label>
                <div class="input-group input-group-lg">
                    <input type="text" id="code" name="code" class="form-control border-0" 
                           placeholder="URL 또는 코드를 입력하세요" 
                           style="background: rgba(30, 27, 75, 0.8); color: #e0e7ff; box-shadow: inset 0 2px 4px rgba(0,0,0,0.3); border-radius: 12px 0 0 12px;">
                    <div class="input-group-append">
                        <button id="analysis_btn" class="btn px-2 px-md-4 font-weight-bold" type="button"
                                style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); color: white; box-shadow: 0 0 15px rgba(139, 92, 246, 0.4);">
                            <i class="fa fa-cogs mr-1"></i> 분석
                        </button>
                        <button id="go_anilife_btn" class="btn px-2 px-md-3" type="button"
                                style="background: rgba(167, 139, 250, 0.2); border: 1px solid rgba(167, 139, 250, 0.4); color: #c4b5fd; border-radius: 0 12px 12px 0;">
                            <span class="d-none d-md-inline">Go 애니라이프</span>
                            <span class="d-md-none">Go</span>
                        </button>
                    </div>
                </div>
                <div class="d-flex align-items-center mt-2 small" style="color: #a78bfa;">
                    <i class="fa fa-info-circle mr-1"></i> 
                    <span>예) "https://anilife.live/g/l?id=xxx" 또는 "f6e83ec6-bd25-4d6c-9428-c10522687604"</span>
                </div>
            </div>
        </div>
    </form>
    
    <form id="program_auto_form">
        <div id="episode_list"></div>
    </form>
</div>
<!--전체-->
<script src="{{ url_for('.static', filename='js/sjva_ui14.js') }}"></script>

<script type="text/javascript">
    const package_name = "{{arg['package_name'] }}";
    const sub = "{{arg['sub'] }}";
    const anilife_url = "{{arg['anilife_url']}}";
    // let current_data = null;

    const params = new Proxy(new URLSearchParams(window.location.search), {
        get: (searchParams, prop) => searchParams.get(prop),
    })


    function findGetParameter(parameterName) {
        let result = null,
            tmp = [];
        const items = location.search.substr(1).split("&");
        for (let index = 0; index < items.length; index++) {
            tmp = items[index].split("=");
            if (tmp[0] === parameterName) result = decodeURIComponent(tmp[1]);
        }
        return result;
    }

    const loader = document.getElementById("preloader");

    const dismissLoadingScreen = async function () {
        // console.log("Before the delay")
        // await delay(2.5);
        loader.style.display = "none";
    };

    const wait_seconds = function () {
        // REFERENCE:  https://www.w3schools.com/jsref/met_win_settimeout.asp
        let result = setTimeout(dismissLoadingScreen, 2500);
        // console.log(result)
    };
    const init = function () {

    }

    function delay(n) {
        return new Promise(function (resolve) {
            setTimeout(resolve, n * 1000);
        });
    }

    async function myAsyncFunction() {
        //Do what you want here
        // console.log("Before the delay")

        await delay(2.5);

        // console.log("After the delay")
        //Do what you want here too

    }

    // myAsyncFunction();
    // window.addEventListener("DOMContentLoaded", dismissLoadingScreen);

    // window.addEventListener("DOMContentLoaded", wait_seconds);

    function analyze(wr_id, bo_table) {
        // e.preventDefault();
        // e.stopPropagation()
        // e.preventDefault();
        const code = document.getElementById("code").value
        // console.log(code)
        $.ajax({
            url: '/' + package_name + '/ajax/' + sub + '/analysis',
            type: "POST",
            cache: false,
            data: {code: code, wr_id: wr_id, bo_table: bo_table},
            dataType: "json",
            success: function (ret) {
                if (ret.ret === 'success' && ret.data != null) {
                    // {#// console.log(ret.code)#}
                    // console.log(ret.data)
                    make_program(ret.data)
                    $("#loader").css("display", 'none')
                } else {
                    $.notify('<strong>분석 실패</strong><br>' + ret.log, {type: 'warning'});
                }
            }
        });
    }

    function make_program(data) {
        current_data = data;
        // // console.log("current_data::", current_data)
        
        // 에피소드 목록을 완전히 숨긴 상태로 시작 (visibility로 레이아웃 시프트 방지)
        const episodeList = document.getElementById("episode_list");
        episodeList.style.visibility = 'hidden';
        episodeList.style.opacity = '0';
        episodeList.style.transition = 'opacity 0.3s ease-in';
        
        str = '';

        // program
        str += m_row_start(0);
        
        let posterHtml = '';
        if (data.image != null) {
            let proxyImgSrc = data.image;
            if (data.image && data.image.includes('cdn.anilife.live')) {
                proxyImgSrc = '/' + package_name + '/ajax/' + sub + '/proxy_image?url=' + encodeURIComponent(data.image);
            }
            posterHtml = '<div class="series-poster-side mb-3 mb-md-0"><img src="' + proxyImgSrc + '" class="img-fluid series-main-img" onerror="this.src=\'../static/img_loader_x200.svg\'"></div>';
        }

        tmp = '';
        tmp += '<div class="mb-3"><strong style="font-size:1.6em; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.3);">' + data.title + '</strong></div>';
        
        // des1 데이터를 각 항목별로 파싱하여 표시
        if (data.des1) {
            // 항목 키워드들로 분리
            const fields = ['상태:', '제작사:', '감독:', '각본:', '원작:', '시즌:', '공식 방영일:', '유형:', '에피소드:', '등급:', '방영 시작일:', '최근 방영일:'];
            let formattedDes = data.des1;
            
            // 각 필드 앞에 줄바꿈 추가
            fields.forEach(field => {
                formattedDes = formattedDes.replace(new RegExp(field, 'g'), '<br><strong>' + field + '</strong> ');
            });
            
            // 첫 번째 br 태그 제거 (첫 줄에는 필요없음)
            formattedDes = formattedDes.replace(/^<br>/, '');
            
            tmp += '<div class="series-info-box d-flex flex-column flex-md-row animate__animated animate__fadeIn">';
            if (posterHtml) {
                tmp += posterHtml;
            }
            tmp += '<div class="series-info-side ml-md-4">' + formattedDes + '</div>';
            tmp += '</div>';
            
            // Integrated Actions Toolbar (Linkkf Style)
            tmp += '<div class="d-flex flex-wrap align-items-center gap-2 p-3 mt-3 rounded" style="background: rgba(30, 27, 75, 0.4); border: 1px solid rgba(167, 139, 250, 0.1);">';
            tmp += '<button id="check_download_btn" class="action-btn action-btn-primary mr-2" style="padding: 8px 16px; font-size: 0.9em;"><i class="fa fa-download"></i> 선택 다운로드</button>';
            tmp += '<button id="all_check_on_btn" class="action-btn action-btn-secondary mr-2" style="padding: 8px 16px; font-size: 0.9em;"><i class="fa fa-check-square-o"></i> 전체 선택</button>';
            tmp += '<button id="all_check_off_btn" class="action-btn action-btn-outline mr-3" style="padding: 8px 16px; font-size: 0.9em;"><i class="fa fa-square-o"></i> 해제</button>';
            tmp += '</div>';
        }

        str += m_col(12, tmp)
        str += m_row_end();

        str += '<div class="episode-list-container">';
        for (i in data.episode) {
            // CDN 이미지 프록시 적용
            let epThumbSrc = data.episode[i].thumbnail || '';
            if (epThumbSrc && epThumbSrc.includes('cdn.anilife.live')) {
                epThumbSrc = '/' + package_name + '/ajax/' + sub + '/proxy_image?url=' + encodeURIComponent(epThumbSrc);
            }
            
            str += '<div class="episode-card">';
            str += '<div class="episode-thumb">';
            if (epThumbSrc) {
                str += '<img src="' + epThumbSrc + '" loading="lazy" onerror="this.src=\'../static/img_loader_x200.svg\'">';
            }
            str += '<span class="episode-num">' + data.episode[i].ep_num + '화</span>';
            str += '</div>';
            str += '<div class="episode-info">';
            str += '<div class="episode-title">' + data.episode[i].title + '</div>';
            if (data.episode[i].date) {
                str += '<div class="episode-date">' + data.episode[i].date + '</div>';
            }
            str += '<div class="episode-actions">';
            str += '<input id="checkbox_' + i + '" name="checkbox_' + i + '" type="checkbox" checked data-toggle="toggle" data-on="선택" data-off="-" data-onstyle="success" data-offstyle="secondary" data-size="small">';
            str += m_button('add_queue_btn', '다운로드', [{'key': 'idx', 'value': i}]);
            str += '</div>';
            str += '</div>';
            str += '</div>';
        }
        str += '</div>';
        episodeList.innerHTML = str;
        $('input[id^="checkbox_"]').bootstrapToggle();
        
        // 이미지 로딩 완료 후 표시 (최대 2초 대기)
        const images = episodeList.querySelectorAll('img');
        let loadedCount = 0;
        const totalImages = images.length;
        
        function showContent() {
            episodeList.style.visibility = 'visible';
            episodeList.style.opacity = '1';
        }
        
        if (totalImages === 0) {
            showContent();
        } else {
            // 최대 2초 후 강제 표시
            const forceShowTimeout = setTimeout(showContent, 2000);
            
            images.forEach(img => {
                if (img.complete) {
                    loadedCount++;
                    if (loadedCount >= totalImages) {
                        clearTimeout(forceShowTimeout);
                        showContent();
                    }
                } else {
                    img.addEventListener('load', function() {
                        loadedCount++;
                        if (loadedCount >= totalImages) {
                            clearTimeout(forceShowTimeout);
                            showContent();
                        }
                    });
                    img.addEventListener('error', function() {
                        loadedCount++;
                        if (loadedCount >= totalImages) {
                            clearTimeout(forceShowTimeout);
                            showContent();
                        }
                    });
                }
            });
        }
    }

    $(function () {
        // console.log(params.wr_id)
        // console.log(findGetParameter('wr_id'))
        // console.log(params.code)
        if (params.code === '') {

        } else {
            document.getElementById("code").value = params.code
            document.getElementById("analysis_btn").click();
        }

        if ("{{arg['anilife_current_code']}}" !== "") {
            if (params.code === null) {
                // console.log('params.code === null')
                document.getElementById("code").value = "{{arg['anilife_current_code']}}";

            } else if (params.code === '') {
                document.getElementById("code").value = "{{arg['anilife_current_code']}}";
            } else {

                // console.log('params code exist')
                // console.log(params.code)
                document.getElementById("code").value = params.code

                analyze(params.wr_id, params.bo_table)
                // document.getElementById("analysis_btn").click();
                // $('#analysis_btn').trigger('click')
            }
            // 값이 공백이 아니면 분석 버튼 계속 누름
            // {#document.getElementById("analysis_btn").click();#}
        } else {

        }

    })

    $(document).ready(function () {
        // DOM 로딩 완료 후 preloader 숨기기
        const preloader = document.getElementById('preloader');
        
        setTimeout(function() {
            if (preloader) {
                preloader.style.opacity = '0';
                setTimeout(function() {
                    preloader.style.display = 'none';
                }, 300);
            }
        }, 500);
        
        $("#loader").css("display", 'none');
    });

    // Enter 키로 검색 트리거
    $("#code").on('keypress', function (e) {
        if (e.which === 13) { // Enter key
            e.preventDefault();
            $("#analysis_btn").click();
        }
    });

    $("#analysis_btn").unbind("click").bind('click', function (e) {
        e.preventDefault();
        e.stopPropagation()
        $("#loader").css("display", 'block')
        const code = document.getElementById("code").value
        // console.log(code)
        $.ajax({
            url: '/' + package_name + '/ajax/' + sub + '/analysis',
            type: "POST",
            cache: false,
            data: {code: code},
            dataType: "json",
            success: function (ret) {
                $("#loader").css("display", 'none')
                if (ret.ret === 'success' && ret.data != null) {
                    // {#// console.log(ret.code)#}
                    // console.log(ret.data)

                    make_program(ret.data)
                    dismissLoadingScreen()
                } else {
                    $.notify('<strong>분석 실패</strong><br>' + ret.log, {type: 'warning'});
                }
            }
        });
    });


    $("body").on('click', '#go_anilife_btn', function (e) {
        e.preventDefault();
        window.open("{{arg['anilife_url']}}", "_blank");
    });

    $("body").on('click', '#all_check_on_btn', function (e) {
        e.preventDefault();
        $('input[id^="checkbox_"]').bootstrapToggle('on')
    });

    $("body").on('click', '#all_check_off_btn', function (e) {
        e.preventDefault();
        $('input[id^="checkbox_"]').bootstrapToggle('off')
    });

    $("body").on('click', '#add_queue_btn', function (e) {
        e.preventDefault();
        data = current_data.episode[$(this).data('idx')];
        // console.log('data:::>', data)
        $.ajax({
            url: '/' + package_name + '/ajax/' + sub + '/add_queue',
            type: "POST",
            cache: false,
            data: {data: JSON.stringify(data)},
            dataType: "json",
            success: function (data) {
                // console.log('#add_queue_btn::data >>', data)
                if (data.ret == 'enqueue_db_append' || data.ret == 'enqueue_db_exist') {
                    $.notify('<strong>다운로드 작업을 추가 하였습니다.</strong>', {type: 'success'});
                } else if (data.ret == 'queue_exist') {
                    $.notify('<strong>이미 큐에 있습니다. 삭제 후 추가하세요.</strong>', {type: 'warning'});
                } else if (data.ret == 'db_completed') {
                    $.notify('<strong>DB에 완료 기록이 있습니다.</strong>', {type: 'warning'});
                } else if (data.ret == 'file_exists') {
                    $.notify('<strong>파일이 이미 존재합니다.</strong>', {type: 'warning'});
                } else {
                    $.notify('<strong>추가 실패</strong><br>' + data.log, {type: 'warning'});
                }
            }
        });

    });

    $("body").on('click', '#check_download_btn', function (e) {
        e.preventDefault();
        all = $('input[id^="checkbox_"]');
        let data = [];
        let idx;
        for (let i in all) {
            if (all[i].checked) {
                idx = parseInt(all[i].id.split('_')[1])
                data.push(current_data.episode[idx]);
            }
        }
        if (data.length == 0) {
            $.notify('<strong>선택하세요.</strong>', {type: 'warning'});
            return;
        }
        $.ajax({
            url: '/' + package_name + '/ajax/' + sub + '/add_queue_checked_list',
            type: "POST",
            cache: false,
            data: {data: JSON.stringify(data)},
            dataType: "json",
            success: function (data) {
                $.notify('<strong>백그라운드로 작업을 추가합니다.</strong>', {type: 'success'});
            }
        });
    });
</script>
<style>
    button.code-button {
        min-width: 82px !important;
    }

    /* Navigation Menu Override */
    ul.nav.nav-pills.bg-light {
        background-color: rgba(30, 41, 59, 0.6) !important;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 50rem !important;
        padding: 6px !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2) !important;
        display: inline-flex !important;
        flex-wrap: wrap;
        justify-content: center;
        width: auto !important;
        margin-bottom: 20px;
    }

    ul.nav.nav-pills .nav-item {
        margin: 0 2px;
    }

    ul.nav.nav-pills .nav-link {
        border-radius: 50rem !important;
        padding: 8px 20px !important;
        color: #94a3b8 !important;
        font-weight: 600;
        transition: all 0.3s ease;
    }

    ul.nav.nav-pills .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: #fff !important;
        transform: translateY(-1px);
    }

    ul.nav.nav-pills .nav-link.active {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
        color: #fff !important;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
    }

    /* ========== Cosmic Violet Theme (Anilife Exclusive) ========== */
    body {
        background: linear-gradient(135deg, #1e1b4b 0%, #312e81 40%, #4c1d95 100%) !important;
        background-attachment: fixed;
        color: #e0e7ff;
        min-height: 100vh;
        font-family: 'Inter', 'Noto Sans KR', system-ui, sans-serif;
    }


    
    .action-btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 10px 18px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: all 0.2s ease;
    }
    
    .action-btn-primary {
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);
    }
    
    .action-btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 6px 20px rgba(139, 92, 246, 0.4);
    }
    
    .action-btn-secondary {
        background: rgba(167, 139, 250, 0.2);
        color: #c4b5fd;
        border: 1px solid rgba(167, 139, 250, 0.3);
    }
    
    .action-btn-secondary:hover {
        background: rgba(167, 139, 250, 0.35);
        color: white;
    }
    
    .action-btn-outline {
        background: transparent;
        color: #a78bfa;
        border: 1px solid rgba(167, 139, 250, 0.3);
    }
    
    .action-btn-outline:hover {
        background: rgba(167, 139, 250, 0.15);
        color: #c4b5fd;
    }

    /* 시리즈 정보 박스 스타일 */
    .series-info-box {
        background: linear-gradient(135deg, rgba(49, 46, 129, 0.95) 0%, rgba(30, 27, 75, 0.95) 100%);
        border-radius: 12px;
        padding: 25px;
        margin-top: 15px;
        color: #e0e7ff;
        border: 1px solid rgba(167, 139, 250, 0.2);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        display: flex;
        gap: 20px;
    }
    
    .series-poster-side {
        width: 180px;
        min-width: 180px;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
        border: 1px solid rgba(255, 255, 255, 0.1);
        align-self: flex-start;
    }
    
    .series-info-side {
        flex: 1;
        line-height: 2.2;
    }
    
    .series-info-box strong {
        color: #a78bfa;
        font-weight: 600;
        min-width: 90px;
        display: inline-block;
    }

    /* 에피소드 목록 컨테이너 */
    .episode-list-container {
        margin-top: 20px;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
        gap: 10px;
    }
    
    /* 에피소드 카드 */
    .episode-card {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 10px 12px;
        background: linear-gradient(135deg, rgba(49, 46, 129, 0.85) 0%, rgba(30, 27, 75, 0.85) 100%);
        border-radius: 8px;
        border: 1px solid rgba(167, 139, 250, 0.15);
        transition: all 0.2s ease;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    }
    
    .episode-card:hover {
        background: linear-gradient(135deg, rgba(76, 29, 149, 0.9) 0%, rgba(49, 46, 129, 0.9) 100%);
        border-color: rgba(167, 139, 250, 0.5);
        transform: translateY(-2px);
        box-shadow: 0 4px 15px rgba(139, 92, 246, 0.25);
    }
    
    /* 에피소드 썸네일 */
    .episode-thumb {
        position: relative;
        width: 56px;
        min-width: 56px;
        height: 42px;
        border-radius: 5px;
        overflow: hidden;
        background: linear-gradient(135deg, rgba(0, 0, 0, 0.3) 0%, rgba(49, 46, 129, 0.5) 100%);
        flex-shrink: 0;
    }
    
    .episode-thumb img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.2s ease;
    }
    
    .episode-card:hover .episode-thumb img {
        transform: scale(1.05);
    }
    
    /* 에피소드 번호 배지 */
    .episode-num {
        position: absolute;
        bottom: 2px;
        left: 2px;
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        color: white;
        font-size: 9px;
        font-weight: 700;
        padding: 1px 5px;
        border-radius: 3px;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
    }
    
    /* 에피소드 정보 */
    .episode-info {
        flex: 1;
        display: flex;
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
        gap: 10px;
        min-width: 0;
    }
    
    .episode-title {
        color: #e0e7ff;
        font-weight: 500;
        font-size: 13px;
        line-height: 1.3;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        flex: 1;
        min-width: 0;
    }
    
    .episode-date {
        color: #a78bfa;
        font-size: 11px;
        white-space: nowrap;
        flex-shrink: 0;
    }
    
    /* 에피소드 액션 버튼 */
    .episode-actions {
        display: flex;
        align-items: center;
        gap: 8px;
        margin-top: 4px;
    }
    
    .episode-actions .btn {
        font-size: 11px;
        padding: 3px 10px;
        border-radius: 4px;
        background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        border: none;
        color: white;
    }
    
    /* Bootstrap Toggle Custom Styling */
    .toggle.btn-success, .toggle.btn-success:hover {
        background: linear-gradient(135deg, #f472b6 0%, #db2777 100%) !important; /* Vibrant Pink/Magenta */
        border: none !important;
        box-shadow: 0 2px 8px rgba(236, 72, 153, 0.3) !important;
        transition: all 0.2s ease !important;
    }
    
    .toggle.btn-success:hover {
        transform: scale(1.05);
        box-shadow: 0 4px 12px rgba(236, 72, 153, 0.4) !important;
    }
    
    .toggle.btn-secondary {
        background: rgba(30, 27, 75, 0.6) !important;
        border: 1px solid rgba(167, 139, 250, 0.2) !important;
    }

    .toggle-on.btn-success {
        background: linear-gradient(135deg, #f472b6 0%, #db2777 100%) !important;
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        padding: 0 !important;
        font-weight: 800 !important;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.4) !important;
    }

    .toggle-off.btn-secondary {
        display: flex !important;
        align-items: center !important;
        justify-content: center !important;
        padding: 0 !important;
        color: #94a3b8 !important;
    }

    .toggle-handle {
        background: rgba(255, 255, 255, 0.9) !important;
        box-shadow: 0 0 10px rgba(255, 255, 255, 0.3) !important;
    }
    
    .episode-actions .toggle {
        transform: scale(0.9);
        width: 60px !important;
        height: 25px !important;
        min-width: 60px !important;
        min-height: 25px !important;
    }
    
    /* 모바일 반응형 - Bootstrap 모든 레이아웃 강제 덮어쓰기 */
    @media (max-width: 768px) {
        /* 상단 서브메뉴가 SJVA 메인 navbar에 가려지지 않도록 여백 추가 */
        ul.nav.nav-pills.bg-light {
            margin-top: 60px !important;
        }
        
        /* 입력창 크기 최적화 */
        .input-group.input-group-lg {
            flex-wrap: nowrap !important;
        }
        .input-group.input-group-lg .form-control {
            flex: 1 1 auto !important;
            min-width: 0 !important;
        }
        .input-group.input-group-lg .input-group-append {
            flex: 0 0 auto !important;
        }
        .input-group.input-group-lg .btn {
            padding-left: 10px !important;
            padding-right: 10px !important;
            font-size: 0.9rem !important;
        }
        
        /* 전체 페이지 기본 설정 */
        body {
            overflow-x: hidden !important;
            padding: 0 !important;
            margin: 0 !important;
        }
        
        /* 모든 컨테이너/row 폭 100% 강제 */
        .container, .container-fluid, .container-sm, .container-md, .container-lg,
        .row, form, #program_list, #program_auto_form, #episode_list {
            width: 100% !important;
            max-width: 100% !important;
            padding-left: 10px !important;
            padding-right: 10px !important;
            margin-left: 0 !important;
            margin-right: 0 !important;
            box-sizing: border-box !important;
        }
        
        /* form-group 및 모든 col 클래스 */
        .form-group, .form-inline,
        [class*="col-"] {
            flex: 0 0 100% !important;
            max-width: 100% !important;
            width: 100% !important;
            padding-left: 0 !important;
            padding-right: 0 !important;
        }
        
        /* row 마진 제거 */
        .row {
            margin-left: 0 !important;
            margin-right: 0 !important;
        }
        
        /* 버튼 그룹 */
        .form-inline {
            display: flex !important;
            flex-wrap: wrap !important;
            gap: 6px !important;
            margin-bottom: 10px !important;
        }
        
        .form-inline .btn {
            font-size: 11px;
            padding: 6px 10px;
        }
        
        /* 시리즈 정보 박스 */
        .series-info-box {
            padding: 15px !important;
            line-height: 1.8 !important;
        }
        
        /* 에피소드 목록 - 화면 폭에 꽉 차게 */
        .episode-list-container {
            display: flex !important;
            flex-direction: column !important;
            gap: 8px !important;
            width: 100% !important;
            max-width: 100% !important;
            padding: 0 !important;
            margin: 15px 0 !important;
            box-sizing: border-box !important;
        }
        
        .episode-card {
            display: flex !important;
            align-items: center !important;
            width: 100% !important;
            max-width: 100% !important;
            padding: 10px 12px !important;
            gap: 10px !important;
            margin: 0 !important;
            box-sizing: border-box !important;
        }
        
        .episode-thumb {
            width: 50px !important;
            min-width: 50px !important;
            height: 38px !important;
            flex-shrink: 0 !important;
        }
        
        .episode-info {
            flex: 1 !important;
            min-width: 0 !important;
            flex-direction: row !important;
            align-items: center !important;
            justify-content: space-between !important;
        }
        
        .episode-title {
            font-size: 12px !important;
            white-space: nowrap !important;
            overflow: hidden !important;
            text-overflow: ellipsis !important;
            line-height: 1.3 !important;
            flex: 1 !important;
            min-width: 0 !important;
        }
        
        .episode-date {
            font-size: 10px !important;
            color: #64748b !important;
            flex-shrink: 0 !important;
            margin-left: 8px !important;
        }
        
        .episode-actions {
            display: flex !important;
            flex-wrap: wrap !important;
            gap: 6px !important;
            margin-top: 5px !important;
        }
        
        .episode-actions .btn {
            font-size: 10px !important;
            padding: 4px 10px !important;
        }
        
        .episode-actions .toggle {
            transform: scale(0.85) !important;
        }
    }
    
    /* 더 작은 화면 (400px 이하) */
    @media (max-width: 400px) {
        .episode-thumb {
            width: 40px !important;
            min-width: 40px !important;
            height: 30px !important;
        }
        
        .episode-num {
            font-size: 8px !important;
        }
        
        .episode-title {
            font-size: 11px !important;
        }
        
        .episode-actions .btn {
            font-size: 9px !important;
            padding: 3px 8px !important;
        }
    }

    .tooltip {
        position: relative;
        display: block;
    }

    [data-tooltip-text]:hover {
        position: relative;
    }

    [data-tooltip-text]:after {
        -webkit-transition: bottom 0.3s ease-in-out, opacity 0.3s ease-in-out;
        -moz-transition: bottom 0.3s ease-in-out, opacity 0.3s ease-in-out;
        transition: bottom 0.3s ease-in-out, opacity 0.3s ease-in-out;

        background-color: rgba(0, 0, 0, 0.8);

        -webkit-box-shadow: 0px 0px 3px 1px rgba(50, 50, 50, 0.4);
        -moz-box-shadow: 0px 0px 3px 1px rgba(50, 50, 50, 0.4);
        box-shadow: 0px 0px 3px 1px rgba(50, 50, 50, 0.4);

        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;

        color: #ffffff;
        font-size: 12px;
        margin-bottom: 10px;
        padding: 7px 12px;
        position: absolute;
        width: auto;
        min-width: 50px;
        max-width: 300px;
        word-wrap: break-word;

        z-index: 9999;

        opacity: 0;
        left: -9999px;
        top: 90%;

        content: attr(data-tooltip-text);
    }

    [data-tooltip-text]:hover:after {
        top: 230%;
        left: 0;
        opacity: 1;
    }

    [data-tooltip-text]:hover {
        position: relative;
    }

    [data-tooltip-text]:after {
        -webkit-transition: bottom 0.3s ease-in-out, opacity 0.3s ease-in-out;
        -moz-transition: bottom 0.3s ease-in-out, opacity 0.3s ease-in-out;
        transition: bottom 0.3s ease-in-out, opacity 0.3s ease-in-out;

        background-color: rgba(0, 0, 0, 0.8);

        -webkit-box-shadow: 0px 0px 3px 1px rgba(50, 50, 50, 0.4);
        -moz-box-shadow: 0px 0px 3px 1px rgba(50, 50, 50, 0.4);
        box-shadow: 0px 0px 3px 1px rgba(50, 50, 50, 0.4);

        -webkit-border-radius: 5px;
        -moz-border-radius: 5px;
        border-radius: 5px;

        color: #ffffff;
        font-size: 12px;
        margin-bottom: 10px;
        padding: 7px 12px;
        position: absolute;
        width: auto;
        min-width: 50px;
        max-width: 300px;
        word-wrap: break-word;

        z-index: 9999;

        opacity: 0;
        left: -9999px;
        top: -210% !important;

        content: attr(data-tooltip-text);
    }

    [data-tooltip-text]:hover:after {
        top: 130%;
        left: 0;
        opacity: 1;
    }

    #airing_list {
        display: none;
    }

    .cut-text {
        text-overflow: ellipsis;
        overflow: hidden;
        white-space: nowrap;
        width: 100%;
    }

    #screen_movie_list {
        margin-top: 10px;
    }

    #preloader {
        /*background-color: green;*/
        /*color: white;*/
        /*height: 100vh;*/
        /*width: 100%;*/
        /*position: fixed;*/
        /*z-index: 100;*/
        background: rgba(0, 0, 0, 0.2);
        background: radial-gradient(#222, #000);
        bottom: 0;
        left: 0;
        overflow: hidden;
        position: fixed;
        right: 0;
        top: 0;
        z-index: 99999;
        opacity: 0.5;
    }

    .loader {
        background: rgb(0, 0, 0, 0.8);
        background: radial-gradient(#222, #000);
        bottom: 0;
        left: 0;
        overflow: hidden;
        position: fixed;
        right: 0;
        top: 0;
        z-index: 99999;
    }

    .loader-inner {
        bottom: 0;
        height: 60px;
        left: 0;
        margin: auto;
        position: absolute;
        right: 0;
        top: 0;
        width: 100px;
    }

    .loader-line-wrap {
        animation: spin 2000ms cubic-bezier(.175, .885, .32, 1.275) infinite;
        box-sizing: border-box;
        height: 50px;
        left: 0;
        overflow: hidden;
        position: absolute;
        top: 0;
        transform-origin: 50% 100%;
        width: 100px;
    }

    .loader-line {
        border: 4px solid transparent;
        border-radius: 100%;
        box-sizing: border-box;
        height: 100px;
        left: 0;
        margin: 0 auto;
        position: absolute;
        right: 0;
        top: 0;
        width: 100px;
    }

    .loader-line-wrap:nth-child(1) {
        animation-delay: -50ms;
    }

    .loader-line-wrap:nth-child(2) {
        animation-delay: -100ms;
    }

    .loader-line-wrap:nth-child(3) {
        animation-delay: -150ms;
    }

    .loader-line-wrap:nth-child(4) {
        animation-delay: -200ms;
    }

    .loader-line-wrap:nth-child(5) {
        animation-delay: -250ms;
    }

    .loader-line-wrap:nth-child(1) .loader-line {
        border-color: hsl(0, 80%, 60%);
        height: 90px;
        width: 90px;
        top: 7px;
    }

    .loader-line-wrap:nth-child(2) .loader-line {
        border-color: hsl(60, 80%, 60%);
        height: 76px;
        width: 76px;
        top: 14px;
    }

    .loader-line-wrap:nth-child(3) .loader-line {
        border-color: hsl(120, 80%, 60%);
        height: 62px;
        width: 62px;
        top: 21px;
    }

    .loader-line-wrap:nth-child(4) .loader-line {
        border-color: hsl(180, 80%, 60%);
        height: 48px;
        width: 48px;
        top: 28px;
    }

    .loader-line-wrap:nth-child(5) .loader-line {
        border-color: hsl(240, 80%, 60%);
        height: 34px;
        width: 34px;
        top: 35px;
    }

    @keyframes spin {
        0%, 15% {
            transform: rotate(0);
        }
        100% {
            transform: rotate(360deg);
        }
    }
    
    /* 로딩 인디케이터 오버라이드 */
    #loading {
        background: rgba(15, 23, 42, 0.85) !important;
        backdrop-filter: blur(8px) !important;
    }
    
    #loading img,
    #loading svg {
        display: none !important;
        visibility: hidden !important;
        width: 0 !important;
        height: 0 !important;
    }
    
    #loading::before {
        content: '';
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 50px;
        height: 50px;
        border: 4px solid rgba(96, 165, 250, 0.2);
        border-top-color: #60a5fa;
        border-radius: 50%;
        animation: loader-spin 0.8s linear infinite;
        z-index: 100001;
    }
    
    @keyframes loader-spin {
        to { transform: translate(-50%, -50%) rotate(360deg); }
    }
    
    #modal_loading img,
    #modal_loading svg {
        display: none !important;
        visibility: hidden !important;
        width: 0 !important;
        height: 0 !important;
    }
    
    #modal_loading::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        border: 3px solid rgba(96, 165, 250, 0.2);
        border-top-color: #60a5fa;
        border-radius: 50%;
        animation: loader-spin 0.8s linear infinite;
    }
</style>

<style>
    /* Smooth Load Transition */
    .content-cloak, 
    #menu_module_div, 
    #menu_page_div {
        opacity: 0;
        transition: opacity 0.5s ease-out;
    }
    
    /* Staggered Delays for Natural Top-Down Flow */
    #menu_module_div.visible {
        opacity: 1;
        transition-delay: 0ms;
    }

    #menu_page_div.visible {
        opacity: 1;
        transition-delay: 150ms;
    }

    .content-cloak.visible {
        opacity: 1;
        transition-delay: 300ms;
    }
    
    /* Navigation Menu Override (Top Sub-menu) */
    ul.nav.nav-pills.bg-light {
        background-color: rgba(30, 41, 59, 0.6) !important;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.08);
        border-radius: 50rem !important;
        padding: 6px !important;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2) !important;
        display: inline-flex !important;
        flex-wrap: wrap;
        justify-content: center;
        width: auto !important;
        margin-bottom: 20px;
    }

    ul.nav.nav-pills .nav-item { margin: 0 2px; }
    ul.nav.nav-pills .nav-link {
        border-radius: 50rem !important;
        padding: 8px 20px !important;
        color: #94a3b8 !important;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    ul.nav.nav-pills .nav-link:hover {
        background-color: rgba(255, 255, 255, 0.1);
        color: #fff !important;
        transform: translateY(-1px);
    }
    ul.nav.nav-pills .nav-link.active {
        background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%) !important;
        color: #fff !important;
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
    }
</style>

<script type="text/javascript">
$(document).ready(function(){
  // Smooth Load Trigger
  setTimeout(function() {
      $('.content-cloak, #menu_module_div, #menu_page_div').addClass('visible');
  }, 100);
});
</script>
</style>

{% endblock %}
